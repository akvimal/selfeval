<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course - SelfEval</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="/">SelfEval</a>
      <div class="navbar-nav ms-auto" id="nav-items">
        <a class="nav-link" href="/">Courses</a>
        <a class="nav-link" href="/signin">Sign In</a>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <!-- Course Header -->
    <section id="course-header" class="mb-4">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Courses</a></li>
          <li class="breadcrumb-item active" id="breadcrumb-course">Loading...</li>
        </ol>
      </nav>
      <h2 id="course-title">Loading...</h2>
      <p class="text-muted" id="course-description"></p>
    </section>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4" id="courseTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">Overview</button>
      </li>
      <li class="nav-item" role="presentation" style="display: none;">
        <button class="nav-link" id="learn-tab" data-bs-toggle="tab" data-bs-target="#learn" type="button" role="tab">Learn</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="practice-tab" data-bs-toggle="tab" data-bs-target="#practice" type="button" role="tab">Practice</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="interview-tab" data-bs-toggle="tab" data-bs-target="#interview" type="button" role="tab">Interview</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">History</button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="courseTabContent">

      <!-- Overview Tab -->
      <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <!-- Summary Cards -->
        <div class="row g-4 mb-4">
          <div class="col-md-3">
            <div class="card text-center h-100">
              <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Total Questions</h6>
                <h2 id="overview-total" class="card-title mb-0">0</h2>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center h-100">
              <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Correct</h6>
                <h2 id="overview-correct" class="card-title mb-0 text-success">0</h2>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center h-100">
              <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Average Score</h6>
                <h2 id="overview-score" class="card-title mb-0 text-primary">0%</h2>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center h-100">
              <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Topics</h6>
                <h2 id="overview-topics" class="card-title mb-0 text-info">0</h2>
              </div>
            </div>
          </div>
        </div>

        <div class="row g-4">
          <!-- Charts -->
          <div class="col-lg-8">
            <div class="card mb-4">
              <div class="card-header">
                <h5 class="mb-0">Topic Performance</h5>
              </div>
              <div class="card-body">
                <canvas id="topic-chart" height="200"></canvas>
                <p id="no-topic-data" class="text-muted text-center py-4" style="display: none;">
                  No topic data yet. Start practicing to see your progress!
                </p>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Question Type Performance</h5>
              </div>
              <div class="card-body">
                <canvas id="type-chart" height="150"></canvas>
                <p id="no-type-data" class="text-muted text-center py-4" style="display: none;">
                  No question type data yet.
                </p>
              </div>
            </div>
          </div>

          <!-- Suggestions -->
          <div class="col-lg-4">
            <div class="card mb-4">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">AI Suggestions</h5>
                <button id="refresh-suggestions" class="btn btn-sm btn-outline-primary">Refresh</button>
              </div>
              <div class="card-body" id="suggestions-content">
                <div class="text-center py-4">
                  <div class="spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                  <p class="mb-0 mt-2">Loading suggestions...</p>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Recent Activity</h5>
              </div>
              <div class="card-body" id="activity-content">
                <p class="text-muted text-center py-4">No recent activity</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Learn Tab -->
      <div class="tab-pane fade" id="learn" role="tabpanel">
        <!-- Topic Selection -->
        <div id="learn-topics" class="row">
          <div class="col-lg-4 mb-4">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0">Topics & Subtopics</h5>
              </div>
              <div class="card-body p-0" id="learn-topics-list" style="max-height: 500px; overflow-y: auto;">
                <p class="text-muted text-center py-4">Loading topics...</p>
              </div>
            </div>
          </div>
          <div class="col-lg-8 mb-4">
            <div class="card h-100">
              <div class="card-header">
                <h5 class="mb-0" id="lesson-title">Select a Subtopic to Learn</h5>
                <small class="text-muted" id="lesson-subtitle"></small>
              </div>
              <div class="card-body" id="lesson-content">
                <div class="text-center py-5">
                  <div class="mb-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="text-muted" viewBox="0 0 16 16">
                      <path d="M8.211 2.047a.5.5 0 0 0-.422 0l-7.5 3.5a.5.5 0 0 0 .025.917l7.5 3a.5.5 0 0 0 .372 0L14 7.14V13a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1V6.739l.686-.275a.5.5 0 0 0 .025-.917l-7.5-3.5Z"/>
                      <path d="M4.176 9.032a.5.5 0 0 0-.656.327l-.5 1.7a.5.5 0 0 0 .294.605l4.5 1.8a.5.5 0 0 0 .372 0l4.5-1.8a.5.5 0 0 0 .294-.605l-.5-1.7a.5.5 0 0 0-.656-.327L8 10.466 4.176 9.032Z"/>
                    </svg>
                  </div>
                  <h5 class="text-muted">Ready to Learn?</h5>
                  <p class="text-muted">Select a topic and subtopic from the left to start a guided lesson.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Lesson View (hidden initially) -->
        <div id="lesson-view" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div>
                <h5 class="mb-0" id="active-lesson-title">Lesson</h5>
                <small class="text-muted" id="active-lesson-topic"></small>
              </div>
              <div>
                <span id="lesson-progress-badge" class="badge bg-info me-2">Step 1</span>
                <button class="btn btn-sm btn-outline-secondary me-2" id="back-to-topics-btn">Back to Topics</button>
                <button class="btn btn-sm btn-outline-danger" id="end-lesson-btn">End Lesson</button>
              </div>
            </div>
            <div class="card-body">
              <div id="lesson-messages" class="chat-messages mb-3" style="max-height: 400px; overflow-y: auto;">
                <!-- Lesson content loads here -->
              </div>
              <div id="lesson-input-area">
                <div class="mb-2">
                  <textarea id="lesson-input" class="form-control" rows="2" placeholder="Type your answer or question..."></textarea>
                </div>
                <div class="d-flex justify-content-between">
                  <button id="lesson-hint-btn" class="btn btn-outline-info">Get Hint</button>
                  <button id="lesson-send-btn" class="btn btn-primary">Send</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Practice Tab -->
      <div class="tab-pane fade" id="practice" role="tabpanel">
        <!-- Selection Section -->
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0" id="practice-section-title">Select Topic</h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="topic-select" class="form-label">Topic</label>
                <select id="topic-select" class="form-select">
                  <option value="">Loading topics...</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="type-select" class="form-label">Question Type</label>
                <select id="type-select" class="form-select">
                  <option value="">Random</option>
                  <!-- Question types loaded dynamically -->
                </select>
              </div>
            </div>
            <!-- Subtopics Section -->
            <div id="practice-subtopics-section" class="mt-3" style="display: none;">
              <label class="form-label">Select a Subtopic <span class="text-danger">*</span></label>
              <div id="practice-subtopics-list" class="d-flex flex-wrap gap-2"></div>
              <small class="text-muted mt-1 d-block">You must select one subtopic to practice</small>
            </div>
            <button id="generate-btn" class="btn btn-primary mt-3" disabled>
              Generate Question
            </button>
          </div>
        </div>

        <!-- Question Display -->
        <div id="question-section" class="mb-4" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div>
                <h5 class="mb-0">Question</h5>
                <small class="text-muted" id="question-context"></small>
              </div>
              <span id="question-type-badge" class="badge bg-secondary"></span>
            </div>
            <div class="card-body">
              <p id="question-text" class="lead mb-4"></p>

              <!-- MCQ Options -->
              <div id="mcq-options" class="options-container" style="display: none;"></div>

              <!-- True/False Options -->
              <div id="tf-options" class="options-container" style="display: none;">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" name="tf-answer" id="tf-true" value="true">
                  <label class="form-check-label" for="tf-true">True</label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" name="tf-answer" id="tf-false" value="false">
                  <label class="form-check-label" for="tf-false">False</label>
                </div>
              </div>

              <!-- Text Answer -->
              <div id="text-answer" style="display: none;">
                <!-- Sample Answer Guide for Concept/Comparison -->
                <div id="answer-guide" class="mb-3" style="display: none;">
                  <a class="text-decoration-none small text-primary" data-bs-toggle="collapse" href="#answer-format-guide" role="button">
                    <i class="bi bi-lightbulb"></i> How should I structure my answer? (click to see guide)
                  </a>
                  <div class="collapse mt-2" id="answer-format-guide">
                    <div class="card card-body bg-light small">
                      <div id="concept-guide" style="display: none;">
                        <strong>For Concept Questions:</strong>
                        <ol class="mb-2 mt-2">
                          <li><strong>Definition:</strong> Start with a clear, concise definition</li>
                          <li><strong>Key Points:</strong> Explain 2-3 important aspects or characteristics</li>
                          <li><strong>Example:</strong> Provide a practical example if applicable</li>
                          <li><strong>Why it matters:</strong> Briefly explain why this concept is important</li>
                        </ol>
                        <div class="bg-white p-2 rounded border">
                          <strong>Example format:</strong><br>
                          <em>"[Concept] is [definition]. Key aspects include: 1) [point], 2) [point]. For example, [practical example]. This is important because [reason]."</em>
                        </div>
                      </div>
                      <div id="comparison-guide" style="display: none;">
                        <strong>For Comparison Questions:</strong>
                        <ol class="mb-2 mt-2">
                          <li><strong>Brief intro:</strong> Acknowledge what you're comparing</li>
                          <li><strong>Similarities:</strong> List 1-2 things they have in common</li>
                          <li><strong>Differences:</strong> List 2-3 key differences</li>
                          <li><strong>When to use:</strong> Explain when you'd choose one over the other</li>
                        </ol>
                        <div class="bg-white p-2 rounded border">
                          <strong>Example format:</strong><br>
                          <em>"Both [A] and [B] are [similarity]. However, [A] differs in that [difference], while [B] [difference]. Use [A] when [scenario], and [B] when [scenario]."</em>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <textarea id="answer-input" class="form-control" rows="4" maxlength="1500" placeholder="Type your answer here..."></textarea>
                <div class="d-flex justify-content-end mt-1">
                  <small id="answer-char-counter" class="text-muted">0 / 1500</small>
                </div>
              </div>

              <!-- Fill in the Blank -->
              <div id="fillblank-answer" style="display: none;">
                <input type="text" id="fillblank-input" class="form-control" placeholder="Type the missing word or phrase...">
              </div>

              <div class="d-flex gap-2 mt-3">
                <button id="submit-btn" class="btn btn-success" disabled>
                  Submit Answer
                </button>
                <button id="skip-btn" class="btn btn-outline-secondary">
                  Skip Question
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Result Display -->
        <div id="result-section" class="mb-4" style="display: none;">
          <div class="card" id="result-card">
            <div class="card-header">
              <h5 class="mb-0">Result</h5>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <span id="result-icon" class="result-icon me-3"></span>
                <div>
                  <h4 id="result-status" class="mb-1"></h4>
                  <span id="result-score" class="badge"></span>
                </div>
              </div>

              <div id="result-feedback" class="alert"></div>

              <div id="detailed-feedback" style="display: none;">
                <div id="strengths-section" class="mb-3" style="display: none;">
                  <h6>Strengths:</h6>
                  <ul id="strengths-list"></ul>
                </div>
                <div id="missing-section" class="mb-3" style="display: none;">
                  <h6>Areas to improve:</h6>
                  <ul id="missing-list"></ul>
                </div>
              </div>

              <div class="mt-4">
                <button id="next-btn" class="btn btn-primary">Next Question</button>
              </div>

              <!-- Dispute container for AI-evaluated questions -->
              <div id="result-dispute-container" style="display: none;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- History Tab -->
      <div class="tab-pane fade" id="history" role="tabpanel">
        <!-- Sub-tabs for Q&A, Interviews, and Disputes -->
        <ul class="nav nav-pills mb-4" id="historySubTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="qa-history-tab" data-bs-toggle="pill" data-bs-target="#qa-history" type="button" role="tab">
              Practice Q&A
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="interview-history-tab" data-bs-toggle="pill" data-bs-target="#interview-history" type="button" role="tab">
              Interviews
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="disputes-tab" data-bs-toggle="pill" data-bs-target="#disputes-history" type="button" role="tab">
              Disputes <span id="disputes-badge" class="badge bg-warning text-dark ms-1" style="display: none;">0</span>
            </button>
          </li>
        </ul>

        <div class="tab-content" id="historySubTabContent">
          <!-- Q&A History Sub-tab -->
          <div class="tab-pane fade show active" id="qa-history" role="tabpanel">
            <!-- Filters -->
            <div class="card mb-4">
              <div class="card-body">
                <div class="row g-3 align-items-end">
                  <div class="col-md-4">
                    <label for="filter-topic" class="form-label">Filter by Topic</label>
                    <select id="filter-topic" class="form-select">
                      <option value="">All Topics</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <label for="filter-result" class="form-label">Filter by Result</label>
                    <select id="filter-result" class="form-select">
                      <option value="">All Results</option>
                      <option value="correct">Correct Only</option>
                      <option value="incorrect">Incorrect Only</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <button id="clear-course-history-btn" class="btn btn-outline-danger">
                      Clear Q&A History
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- History Stats -->
            <div class="row g-3 mb-4">
              <div class="col-md-4">
                <div class="card text-center">
                  <div class="card-body">
                    <h6 class="text-muted">Total Questions</h6>
                    <h3 id="history-stat-total" class="mb-0">0</h3>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card text-center">
                  <div class="card-body">
                    <h6 class="text-muted">Correct</h6>
                    <h3 id="history-stat-correct" class="mb-0 text-success">0</h3>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card text-center">
                  <div class="card-body">
                    <h6 class="text-muted">Incorrect</h6>
                    <h3 id="history-stat-incorrect" class="mb-0 text-danger">0</h3>
                  </div>
                </div>
              </div>
            </div>

            <!-- History List -->
            <div id="history-list">
              <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading history...</p>
              </div>
            </div>
          </div>

          <!-- Interview History Sub-tab -->
          <div class="tab-pane fade" id="interview-history" role="tabpanel">
            <!-- Interview Stats -->
            <div class="row g-3 mb-4">
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h6 class="text-muted">Total Interviews</h6>
                    <h3 id="interview-stat-total" class="mb-0">0</h3>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h6 class="text-muted">Average Score</h6>
                    <h3 id="interview-stat-avg" class="mb-0 text-primary">0%</h3>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h6 class="text-muted">Total Questions</h6>
                    <h3 id="interview-stat-questions" class="mb-0 text-info">0</h3>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card text-center">
                  <div class="card-body">
                    <h6 class="text-muted">Total Time</h6>
                    <h3 id="interview-stat-time" class="mb-0 text-secondary">0:00</h3>
                  </div>
                </div>
              </div>
            </div>

            <!-- Past Interviews List -->
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Interview Sessions</h5>
                <button id="clear-interview-history-btn" class="btn btn-sm btn-outline-danger">
                  Clear Interview History
                </button>
              </div>
              <div class="card-body" id="past-interviews">
                <p class="text-muted text-center py-3">No past interviews</p>
              </div>
            </div>
          </div>

          <!-- Disputes Sub-tab -->
          <div class="tab-pane fade" id="disputes-history" role="tabpanel">
            <div class="card">
              <div class="card-header">
                <h5 class="mb-0">Your Disputed Questions</h5>
              </div>
              <div class="card-body">
                <p class="text-muted small mb-3">
                  Disputes allow you to challenge AI evaluations for Concept, Comparison, and Fill-in-the-Blank questions.
                  An admin will review your dispute and may re-evaluate your answer.
                </p>

                <!-- Dispute Filter -->
                <div class="mb-3">
                  <select id="dispute-filter" class="form-select form-select-sm" style="width: auto;">
                    <option value="">All Disputes</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="disapproved">Disapproved</option>
                  </select>
                </div>

                <div id="disputes-list">
                  <p class="text-muted text-center py-3">Loading disputes...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Interview Tab -->
      <div class="tab-pane fade" id="interview" role="tabpanel">
        <!-- Eligibility Warning -->
        <div id="interview-eligibility-warning" class="alert alert-warning mb-4" style="display: none;">
          <h5 class="alert-heading">Practice Required</h5>
          <p id="eligibility-message" class="mb-2"></p>
          <hr>
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>Your Progress:</strong>
              <span id="eligibility-progress"></span>
            </div>
            <a href="#practice" class="btn btn-warning" onclick="document.getElementById('practice-tab').click();">Go to Practice</a>
          </div>
        </div>

        <!-- Interview Setup -->
        <div id="interview-setup" class="card mb-4">
          <div class="card-header">
            <h5 class="mb-0">Start an Interview Session</h5>
          </div>
          <div class="card-body">
            <p class="text-muted mb-3">I'll act as an interviewer and ask you questions about this course's topics. I'll probe deeper based on your answers and provide feedback.</p>

            <!-- Interviewer Persona Selection -->
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="persona-select" class="form-label">
                  <strong>Interviewer Style</strong>
                  <small class="text-muted d-block">Choose who will interview you</small>
                </label>
                <select id="persona-select" class="form-select">
                  <option value="">General Interviewer</option>
                  <!-- Personas loaded dynamically -->
                </select>
                <div id="persona-description" class="form-text mt-1"></div>
              </div>

              <div class="col-md-6">
                <label for="role-select" class="form-label">
                  <strong>Target Role</strong>
                  <small class="text-muted d-block">Role you're being evaluated for</small>
                </label>
                <select id="role-select" class="form-select">
                  <option value="">-- Select Role --</option>
                  <optgroup label="Experience Levels" id="generic-roles-group">
                    <!-- Generic roles loaded dynamically -->
                  </optgroup>
                  <optgroup label="Specialized Roles" id="course-roles-group">
                    <!-- Course-specific roles loaded dynamically -->
                  </optgroup>
                </select>
                <div id="role-description" class="form-text mt-1"></div>
              </div>
            </div>

            <hr class="my-3">

            <div class="mb-3">
              <label class="form-label"><strong>Topic Selection</strong></label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="interview-topic-mode" id="topic-random" value="random" checked>
                <label class="form-check-label" for="topic-random">
                  Let AI choose topics randomly
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="interview-topic-mode" id="topic-select-mode" value="select">
                <label class="form-check-label" for="topic-select-mode">
                  Choose specific topics
                </label>
              </div>
            </div>

            <div id="topic-checkboxes" class="mb-3" style="display: none;">
              <label class="form-label">Select Topics:</label>
              <div id="interview-topics-list" class="row g-2">
                <!-- Topics loaded dynamically -->
              </div>
            </div>

            <button id="start-interview-btn" class="btn btn-primary">
              Start Interview
            </button>
          </div>
        </div>

        <!-- Interview Chat -->
        <div id="interview-chat" style="display: none;">
          <div class="card">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0">Interview in Progress</h5>
                <button id="end-interview-btn" class="btn btn-sm btn-outline-danger">End Interview</button>
              </div>
              <div class="d-flex flex-wrap gap-2" id="interview-context-badges">
                <span id="topic-badge" class="badge bg-success" style="display: none;">
                  Topic: <span id="topic-badge-text"></span>
                </span>
                <span id="persona-badge" class="badge bg-primary" style="display: none;">
                  <span id="persona-badge-text"></span>
                </span>
                <span id="role-badge" class="badge bg-info" style="display: none;">
                  <span id="role-badge-text"></span>
                </span>
                <span id="difficulty-badge" class="badge bg-secondary">
                  Level: <span id="difficulty-level">2</span>/4 (<span id="difficulty-name">Mid-Level</span>)
                </span>
                <span id="questions-badge" class="badge bg-dark">
                  Questions: <span id="question-count">1</span>
                </span>
                <span id="duration-badge" class="badge bg-dark">
                  Time: <span id="session-duration">0:00</span>
                </span>
              </div>
            </div>
            <div class="card-body">
              <div id="chat-messages" class="chat-messages mb-3">
                <!-- Messages loaded dynamically -->
              </div>
              <!-- Sample Response Guide (collapsible) -->
              <div class="mb-3">
                <a class="text-decoration-none small" data-bs-toggle="collapse" href="#sample-response-guide" role="button" aria-expanded="false">
                  <i class="bi bi-lightbulb"></i> How should I answer? (click to see example)
                </a>
                <div class="collapse mt-2" id="sample-response-guide">
                  <div class="card card-body bg-light small">
                    <p class="mb-2"><strong>Good interview responses should:</strong></p>
                    <ul class="mb-2">
                      <li><strong>Be detailed</strong> - Explain your thought process, not just the answer</li>
                      <li><strong>Give examples</strong> - Reference real scenarios or code when relevant</li>
                      <li><strong>Show depth</strong> - Discuss trade-offs, alternatives, and edge cases</li>
                      <li><strong>Be structured</strong> - Organize complex answers into clear points</li>
                    </ul>
                    <p class="mb-1"><strong>Example response length:</strong></p>
                    <p class="text-muted mb-0" style="font-style: italic;">
                      "For handling authentication, I'd use JWT tokens stored in httpOnly cookies for security.
                      The flow would be: user submits credentials, server validates and returns a JWT,
                      client stores it and sends with each request via the Authorization header.
                      I'd also implement refresh tokens to handle expiration gracefully.
                      The main trade-off is between session-based auth (simpler, but requires server state)
                      vs JWT (stateless, but harder to revoke). For scalability, JWT is often preferred..."
                    </p>
                  </div>
                </div>
              </div>

              <div class="mb-2">
                <textarea id="interview-input" class="form-control" rows="4" maxlength="1500" placeholder="Type your response... (Shift+Enter for new line, Enter to send)"></textarea>
                <div class="d-flex justify-content-between mt-1">
                  <small class="text-muted">Tip: Aim for 3-5 sentences minimum. Be specific and explain your reasoning.</small>
                  <small id="char-counter" class="text-muted">0 / 1500</small>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <button id="skip-interview-btn" class="btn btn-outline-secondary">Skip Question</button>
                  <small class="text-muted ms-2">Skipping 3 questions on the same topic will end the interview</small>
                </div>
                <button id="send-response-btn" class="btn btn-primary">Send</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Interview Summary -->
        <div id="interview-summary" style="display: none;">
          <div class="card">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Interview Summary</h5>
                <div id="summary-badges" class="d-flex gap-2">
                  <!-- Persona and role badges shown here -->
                </div>
              </div>
            </div>
            <div class="card-body" id="summary-content">
              <!-- Summary loaded dynamically -->
            </div>
            <div class="card-footer">
              <button id="new-interview-btn" class="btn btn-primary">Start New Interview</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p id="loading-text" class="mt-2">Loading...</p>
    </div>

    <!-- Question Detail Modal -->
    <div class="modal fade" id="questionModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Question Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="modal-content"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="retry-btn">Retry Question</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer mt-auto py-3 bg-light">
    <div class="container text-center">
      <span class="text-muted">SelfEval - AI-Powered Learning</span>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/course.js"></script>
</body>
</html>
